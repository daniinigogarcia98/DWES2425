<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="axios/dist/axios.min.js"></script>
    <title>Mis Tareas</title>
</head>
<body>
    <div class="container mt-4">
        <form action="">
            <h2>Crear Tarea</h2>
            <div class="mb-3">
                <input type="date" name="fecha" id="fecha" class="form-control">
            </div>
            <div class="mb-3">
                <input type="time" name="hora" id="hora" class="form-control">
            </div>
            <div class="mb-3">
                <input type="text" name="desc" id="desc" placeholder="Descripción" class="form-control">
            </div>
            <div class="mb-3">
                <select name="prioridad" id="prioridad" class="form-select">
                    <option value="Alta">Alta</option>
                    <option selected="selected" value="Media">Media</option>
                    <option value="Baja">Baja</option>
                </select>
            </div>
            <button type="button" name="crear" class="btn btn-success" onclick="crearTareas()">Crear</button>
        </form>
        <h2 class="mt-5">Lista de Tareas</h2>
        <table class="table table-bordered table-hover" id="tabla">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Prioridad</th>
                    <th>Descripción</th>
                    <th>Finalizado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <!-- Las filas de la tabla se insertarán aquí dinámicamente -->
            </tbody>
        </table>
    </div>

    <script>
        function crearTareas() {
            const url = 'http://localhost/DWES2425/U5/APITareas/public/tareas';
            if (document.getElementById('fecha').value === '' 
            || document.getElementById('hora').value === '' 
            || document.getElementById('desc').value === '') {
                alert('Error: Debe rellenar todos los campos');
            } else {
                const datos = {
                    fecha: document.getElementById('fecha').value,
                    hora: document.getElementById('hora').value,
                    descripcion: document.getElementById('desc').value,
                    prioridad: document.getElementById('prioridad').value
                }
                axios.post(url, datos)
                .then(response => {
                    const respuesta = response.data;
                    alert(`Tarea con id ${respuesta.tarea.id} creada`);
                    cargarTareas();
                })
                .catch(error => {
                    console.log(error);
                    alert(`Error: ${error.response.data} Estado: ${error.response.status}`);
                    cargarTareas();
                    // Limpiar formulario
                    document.getElementById('fecha').value = '';
                    document.getElementById('hora').value = '';
                    document.getElementById('desc').value = '';
                    document.getElementById('prioridad').value = 'Media';
                });
            }
        }

        function cargarTareas() {
            const url = 'http://localhost/DWES2425/U5/APITareas/public/tareas';
            axios.get(url)
            .then(Response => {
                const tareas = Response.data;
                const tabla = document.getElementById('tabla').getElementsByTagName('tbody')[0];
                tabla.innerHTML = ''; // Limpiar la tabla antes de agregar nuevas filas
                tareas.forEach(t => {
                    const fila = document.createElement('tr');
                    fila.innerHTML = `<td>${t.id}</td>
                    <td>${t.fecha}</td>
                    <td>${t.hora}</td>
                    <td>${t.prioridad}</td>
                    <td>${t.descripcion}</td>
                    <td>${t.finalizado ? 'Sí' : 'No'}</td>
                    <td>
                        <button type="button" class="btn btn-warning btn-sm" onclick="finalizarTarea(${t.id})">Finalizar</button>
                        <button type="button" class="btn btn-danger btn-sm" onclick="borrarTarea(${t.id})">Borrar</button>
                    </td>`;
                    tabla.appendChild(fila);
                });
            })
            .catch(error => {
                console.log(error);
                alert(`Error: ${error.response.data} Estado: ${error.response.status}`);
            });
        }


        window.onload = cargarTareas;
    </script>
</body>
</html>
